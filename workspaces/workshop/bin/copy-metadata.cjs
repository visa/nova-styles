/**
 *              Copyright (c) 2025 Visa, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 **/
"use strict"

const Process = require('../../../bin/process'); 
const fs = require('fs'); 
const chokidar = require('chokidar');
const path = require('path'); 

const { getFile } = require('../../../bin/fsio.cjs');

const SOURCE = '../styles/dist/data.json';
const DEST = './src/data/docs/metadata.js'; 

module.exports = Process((args) => {
  
  const copyMetadata = () => {
    console.log("Copying metadata.\n");
    const metadata = getFile(path.resolve(SOURCE));
    const metadataFile = `// this file is autogenerated \n
const metadata = ${metadata}; \n
export default metadata;`; 
    fs.writeFileSync(path.resolve(DEST), metadataFile);
  }; 

  if (args['watch']) {
    chokidar.watch(path.resolve(SOURCE)).on('change', (e, p) => {
      copyMetadata();
    }); 
  } else {
    copyMetadata(); 
  }
}); 