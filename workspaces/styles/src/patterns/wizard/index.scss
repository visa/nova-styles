/**
 *              Â© 2025 Visa
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 **/
@use '../../base/breakpoints/vars' as *; 
@use '../../base/typography/vars' as *;
@use './_vars' as *;

@layer patterns {
  .v-wizard {
    $root: &;
    inline-size: 100%;

    &:not(:has(.v-accordion)) {
      display: flex;
      flex-direction: var(--v-wizard-flex-direction);
      flex-wrap: wrap;

      &.v-wizard-compact {
        flex-wrap: nowrap;
      }
    }

    // vertical
    &-vertical {
      #{--v-wizard-flex-direction}: var(--v-wizard-vertical-flex-direction);
      max-inline-size: var(--v-wizard-vertical-max-inline-size);
    }

    // chevron icon should be active subtle when collapsed
    .v-accordion-toggle-icon-closed {
      #{--v-accordion-icon-color}: var(--v-wizard-step-icon-color); 
    }
  }

  .v-wizard-step {
    @include typography-label-large;
    display: flex;

    // general wizard step styles
    &:not(:has(.v-button)):not(.v-wizard-compact &),
    & > .v-button:not(.v-accordion-heading)  {
      gap: var(--v-wizard-step-gap); // sass-lint:disable-line no-misspelled-properties
      padding-block: var(--v-wizard-step-padding-block);
      padding-inline: var(--v-wizard-step-padding-inline);

      &:not(.v-wizard-vertical *) {
        align-items: flex-start;
      }
    }

    &:not(& > .v-button):not(&.v-accordion):not(:has(.v-badge-stable)):not(:has(.v-badge-critical)) {
      color: var(--v-wizard-step-color);
    }

    // single page wizard step styles
    .v-accordion-heading:not([open]):not([aria-expanded="true"]) {

        &:not(&[disabled]):not(&[aria-disabled="true"]) {
          // sass-lint:disable-block no-duplicate-properties
          #{--v-accordion-foreground-initial}: var(--palette-default-text-subtle);
        }
      
      .v-typography-color-subtle {
        .v-badge-subtle:not(.v-badge-active) {
          --v-badge-border-color: var(--palette-default-text-subtle);
          --v-badge-foreground: var(--palette-default-text-subtle);
        }
      }
      
      &:hover,
      &:focus-visible {
        &:not(:has(.v-badge-critical)):not(:has(.v-badge-stable)) {
          .v-badge:not(.v-badge-critical):not(.v-badge-stable):not(.v-badge-active) {
            // sass-lint:disable-block no-duplicate-properties
            #{--v-badge-foreground}: var(--palette-default-active-hover);
            #{--v-badge-border-color}: var(--palette-default-active-hover);
          }
          
          .v-accordion-toggle-icon {
            #{--v-accordion-icon-color}: var(--palette-default-active-hover);
          }
        }
      }

      &:active {
        &:not(:has(.v-badge-critical)):not(:has(.v-badge-stable)) {
          .v-badge:not(.v-badge-critical):not(.v-badge-stable):not(.v-badge-active) {
            #{--v-badge-foreground}: var(--palette-default-active-pressed);
            #{--v-badge-border-color}: var(--palette-default-active-pressed);
          }
          
          .v-accordion-toggle-icon {
            #{--v-accordion-icon-color}: var(--palette-default-active-pressed);
          }
        }
      }
    }

    // single page open completed step styles
    &.v-accordion[open] > .v-accordion-heading,
    &.v-accordion > .v-accordion-heading[aria-expanded="true"] {
      &:not(&[disabled]):not(&[aria-disabled="true"]) {
        #{--v-accordion-foreground-initial}: var(--palette-default-active);
      }
      
      &:has(.v-badge-critical) {
        color: var(--palette-default-text);

        .v-badge {
          #{--v-badge-background}: var(--v-badge-error-icon-color);
          #{--v-badge-foreground}: var(--v-badge-icon-foreground);
        }

        .v-accordion-toggle-icon-open {
          #{--v-icon-primary}: var(--palette-default-active-subtle);
          #{--v-icon-secondary}: var(--palette-default-active-subtle);
        }
      }
    }

    // single page open error step styles
    &.v-accordion[open] > .v-accordion-heading,
    &.v-accordion > .v-accordion-heading[aria-expanded="true"] {
      &:has(.v-badge-stable) {
        color: var(--palette-default-text);

        .v-badge {
          #{--v-badge-background}: var(--v-badge-stable-icon-color);
          #{--v-badge-foreground}: var(--v-badge-icon-foreground);
        }

        .v-accordion-toggle-icon-open {
          #{--v-icon-primary}: var(--palette-default-active-subtle);
          #{--v-icon-secondary}: var(--palette-default-active-subtle);
        }
      }
    }

    // horizontal wizard step styles
    &:not(.v-accordion):not(.v-wizard-compact > &):not(.v-wizard-vertical  &),
    & > .v-button:not(.v-accordion-heading):not(:is(.v-wizard-vertical > & > .v-button)) {
      justify-content: space-between;
      max-inline-size: var(--v-wizard-step-max-inline-size);
      block-size: fit-content;
      text-align: left;

      .v-badge {
        transform-origin: top;
      }
    }

    // non-button steps
    &:not(.v-accordion):not(.v-wizard-compact > &):not(.v-wizard-vertical  &):not(:has(> .v-button)) {
      flex: 1 0 0;
    }

    & > .v-icon,
    & > .v-button:not(.v-accordion-heading) > .v-icon {
      // sass-lint:disable-block no-duplicate-properties
      #{--v-icon-primary}: var(--v-wizard-step-icon-color);
      #{--v-icon-secondary}: var(--v-wizard-step-icon-color);
    }

    // wizard step as button or link
    &:has(> .v-button:not(.v-accordion-heading)) {
      display: contents;
    }

    & > .v-button:not(.v-accordion-heading) {
      @include typography-label-large;
    }

    & > .v-button {
      display: flex;
      flex: 1;
      align-items: flex-start;
      block-size: unset;
      inline-size: unset;
      padding-block: var(--v-wizard-step-padding-block);
      padding-inline: var(--v-wizard-step-padding-inline);

      &:not(:has(.v-accordion-toggle-icon)) {
        color: var(--v-wizard-step-color);
      }

      &:hover,
      &:focus-visible {
        color: var(--palette-default-active-hover);

        .v-badge:not(.v-badge-critical):not(.v-badge-stable):not(.v-badge-active) {
          // sass-lint:disable-block no-duplicate-properties
          #{--v-badge-foreground}: var(--palette-default-active-hover);
          #{--v-badge-border-color}: var(--palette-default-active-hover);
        }
      }

      &:active {
        color: var(--palette-default-active-pressed);

        .v-badge:not(.v-badge-critical):not(.v-badge-stable):not(.v-badge-active) {
          #{--v-badge-foreground}: var(--palette-default-active-pressed);
          #{--v-badge-border-color}: var(--palette-default-active-pressed);
        }
      }

      &[disabled],
      &[aria-disabled="true"] {
        // sass-lint:disable-block no-duplicate-properties
        #{--v-accordion-border-color}: var(--palette-default-border);
      }
    }

    // numbers in badges appear too low, this makes them appear centered
    & .v-badge {
      line-height: 0px;
    }

    // vertical
    @at-root .v-wizard-vertical {
      .v-wizard-step,
      .v-wizard-step > .v-button:not(.v-accordion-heading) {
        justify-content: flex-start;
        align-items: center;
      }
    }

    // // wizard step as badge (compact)
    @at-root .v-wizard-compact {
      .v-wizard-step {
        flex: 1;
        align-items: center;
        position: relative;
        max-inline-size: calc(var(--v-wizard-compact-step-block-size) + var(--size-scalable-72));
        
        .v-badge {
          box-sizing: border-box;
          max-block-size: var(--v-wizard-compact-step-block-size);
          max-inline-size: var(--v-wizard-compact-step-block-size);
          min-block-size: var(--v-wizard-compact-step-block-size);
          min-inline-size: var(--v-wizard-compact-step-block-size);
        }

        &:not(:last-child) {
          &::after {
            background-color: var(--v-wizard-compact-step-rail-color);
            content: '';
            display: inline-block;
            height: 2px;
            flex: 1;
            min-inline-size: var(--size-scalable-12);
          }
        }

        // Remove flex from last step to avoid extra space
        &:last-child {
          flex: 0 0 var(--v-wizard-compact-step-block-size);
        }
      }
    }
  }

  // horizontal wizard wrap on smaller screens
    @media (max-width: #{$breakpoint-md - 1}) {
    .v-wizard:not(.v-wizard-compact):not(.v-wizard-vertical):not(:has(.v-accordion)) {
      --v-wizard-flex-direction: column;
      --v-wizard-step-max-inline-size: var(--v-wizard-step-max-inline-size-md);
      max-inline-size: var(--v-wizard-step-max-inline-size-md);
      padding-inline: calc(var(--size-scalable-48) - var(--v-wizard-step-padding-inline));
    }
  }

  // for number badges using v-badge-icon instead of v-badge-number classes
  @media (forced-colors: active) {
    .v-badge:not(.v-badge-clear):not(:has(.v-icon)) {
      // sass-lint:disable-block no-duplicate-properties
      #{--v-badge-background}: #fff;
      #{--v-badge-foreground}: #000;
      outline: 1px solid #000;
      forced-color-adjust: none;
    }
  }

  @media (forced-colors: active) and (prefers-color-scheme: light) {
    // light MS High Contrast theme
    
    .v-badge:not(.v-badge-clear):not(:has(.v-icon)) {
      #{--v-badge-background}: #000;
      #{--v-badge-foreground}:  #fff;
      outline: 1px solid #fff;
    }
  }
}
